<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=480">

    <link rel="stylesheet" type="text/css" media="screen" href="/capnproto/stylesheets/stylesheet.css">

    <title>Cap'n Proto: Other Languages</title>

    <script type="text/javascript" src="/capnproto/javascripts/main.js"></script>
  </head>

  <body class="desktop">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <header class="inner">
        <img src="/capnproto/images/captain_proto.png">
        <div id="infinitely_faster">
          <img src="/capnproto/images/infinitely_faster.png">
        </div>
      </header>
      <a id="discuss_banner" href="https://groups.google.com/group/capnproto">Discuss on Groups</a>
      <a id="forkme_banner" href="https://github.com/kentonv/capnproto">View on GitHub</a>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">

      <section id="menu">
        <ul>
          <li><a href="/capnproto/index.html">Introduction</a></li>
          <li><a href="/capnproto/news/">News</a></li>
          <li><a href="/capnproto/install.html">Installation</a></li>
          <li><a href="/capnproto/language.html">Schema Language</a></li>
          <li><a href="/capnproto/encoding.html">Encoding</a></li>
          <li><a href="/capnproto/rpc.html">RPC Protocol</a></li>
          <li><a href="/capnproto/cxx.html">C++ Runtime</a></li>
          <li><a href="/capnproto/otherlang.html">Other Languages</a></li>
        </ul>
      </section>
      <section id="main_content" class="inner">

<h1 id='other_languages'>Other Languages</h1>

<p>Cap&#8217;n Proto&#8217;s reference implementation is in C++. Implementations in other languages are maintained by respective authors and have not been reviewed by me (<a href='https://github.com/kentonv'>@kentonv</a>). Here are the implementations I&#8217;m aware of:</p>

<h5 id='ready_to_use'>Ready To Use</h5>

<ul>
<li><a href='cxx.html'>C++</a> by <a href='https://github.com/kentonv'>@kentonv</a> &#8211; Official reference implementation</li>
</ul>

<h5 id='works_in_progress'>Works In Progress</h5>

<ul>
<li><a href='https://github.com/jmckaskill/go-capnproto'>C and Go</a> by <a href='https://github.com/jmckaskill'>@jmckaskill</a></li>

<li><a href='https://github.com/jparyani/capnpc-python-cpp'>Python (via C extensions)</a> by <a href='https://github.com/jparyani'>@jparyani</a></li>

<li><a href='https://github.com/dwrensha/capnproto-rust'>Rust</a> by <a href='https://github.com/dwrensha'>@dwrensha</a></li>
</ul>

<h2 id='contribute_your_own'>Contribute Your Own!</h2>

<p>We&#8217;d like to support many more languages in the future!</p>

<p>If you&#8217;d like to own the implementation of Cap&#8217;n Proto in some particular language, <a href='https://groups.google.com/group/capnproto'>let us know</a>!</p>

<p><strong>You should e-mail the list <em>before</em> you start hacking.</strong> We don&#8217;t bite, and we&#8217;ll probably have useful tips that will save you time. :)</p>

<p><strong>Do not implement your own schema parser.</strong> The schema language is more complicated than it looks, and the algorithm to determine offsets of fields is subtle. If you reuse <code>capnpc</code>&#8217;s parser, you won&#8217;t risk getting these wrong, and you won&#8217;t have to spend time keeping your parser up-to-date. In fact, you can still write your code generator in any language you want, using compiler plugins!</p>

<h3 id='how_to_write_compiler_plugins'>How to Write Compiler Plugins</h3>

<p>The Cap&#8217;n Proto compiler / code generator binary, <code>capnpc</code>, supports a &#8220;plugin&#8221; interface for custom code generators. Plugins are independent executables (written in any language) which read a description of the schema from standard input and then generate the necessary code. The description is itself a Cap&#8217;n Proto message, defined by <a href='https://github.com/kentonv/capnproto/blob/master/c%2B%2B/src/capnp/schema.capnp'>schema.capnp</a>. Specifically, the plugin receives a <code>CodeGeneratorRequest</code>, using <a href='http://kentonv.github.io/capnproto/encoding.html#serialization_over_a_stream'>standard serialization</a> (not packed). (Note that installing the C++ runtime causes schema.capnp to be placed in <code>$PREFIX/include/capnp</code> &#8211; <code>/usr/local/include/capnp</code> by default).</p>

<p>Of course, because the input to a plugin is itself in Cap&#8217;n Proto format, if you write your plugin directly in the language you wish to support, you may have a bootstrapping problem: you somehow need to generate code for <code>schema.capnp</code> before you write your code generator. Luckily, because of the simplicity of the Cap&#8217;n Proto format, it is generally not too hard to do this by hand. Remember that you can use <code>capnpc -v schema.capnp</code> to get a dump of the sizes and offsets of all structs and fields defined in the file.</p>

<p><code>capnpc</code> normally looks for plugins in <code>$PATH</code> with the name <code>capnpc-[language]</code>. However, if the language name given on the command line contains a slash character, <code>capnpc</code> assumes that it is an exact path to the plugin executable, and does not search <code>$PATH</code>. Examples:</p>

<pre><code># Searches $PATH for executable &quot;capnpc-mylang&quot;.
capnpc -o mylang addressbook.capnp

# Uses plugin executable &quot;myplugin&quot; from the current directory.
capnpc -o ./myplugin addressbook.capnp</code></pre>

<p>If the user specifies an output directory, the compiler will run the plugin with that directory as the working directory, so you do not need to worry about this.</p>

<p><a href='https://github.com/kentonv/capnproto/blob/master/c%2B%2B/src/capnp/compiler/capnpc-capnp.c%2B%2B'>This example plugin</a> writes the schema back to standard output in Cap&#8217;n Proto schema language, similar to what <code>capnpc -v</code> does.</p>

<h3 id='supporting_dynamic_languages'>Supporting Dynamic Languages</h3>

<p>Dynamic languages have no compile step. This makes it difficult to work <code>capnpc</code> into the workflow for such languages. Additionally, dynamic languages are often scripting languages that do not support pointer arithmetic or any reasonably-performant alternative.</p>

<p>Fortunately, dynamic languages usually have facilities for calling native code. The best way to support Cap&#8217;n Proto in a dynamic language, then, is to wrap the C++ library, in particular the <a href='cxx.html#dynamic_reflection'>C++ dynamic API</a>. This way you get reasonable performance while still avoiding the need to generate any code specific to each schema.</p>

<p>Of course, you still need to parse the schema. As of v0.1, the C++ runtime only has the ability to load schemas that have already been parsed and translated to a binary format (defined by <code>schema.capnp</code>, the same format used by compiler plugins). It cannot parse <code>.capnp</code> files directly. In a future version of Cap&#8217;n Proto, the schema parser will be rewritten from Haskell to C++ to solve this problem. For now, you can hack around it by invoking <code>capnpc</code> as a subprocess. Running <code>capnpc -o/bin/cat myschema.capnp</code>, for example, will cause <code>capnpc</code> to invoke <code>cat</code> as if it were a compiler plugin causing the compiled schemas to be written back to stdout, from which your calling process can parse and load them.</p>
<script type="text/javascript">setupSidebar()</script>
        <div style="clear: both;"></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cap'n Proto maintained by <a href="https://github.com/kentonv">kentonv</a>
          <span class="gplus-followbutton"><span class="g-follow" data-annotation="bubble" data-height="15" data-href="//plus.google.com/118187272963262049674" data-rel="author"></span></span></p>
        <p>Design by <a href="http://www.starfruit-cafe.net/blog">sailorhg</a> âˆ™ Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    <!-- Google+ follow button. -->
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>

    <!-- Google Analytics. -->
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-39711112-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>

