<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=480">

    <link rel="stylesheet" type="text/css" media="screen" href="/capnproto/stylesheets/stylesheet.css">

    <title>Cap'n Proto: Other Languages</title>

    <script type="text/javascript" src="/capnproto/javascripts/main.js"></script>
  </head>

  <body class="desktop">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <header class="inner">
        <img src="/capnproto/images/logo.png">
        <div id="infinitely_faster">
          <img src="/capnproto/images/infinitely_faster.png">
        </div>
      </header>
      <a id="discuss_banner" href="https://groups.google.com/group/capnproto">Discuss on Groups</a>
      <a id="forkme_banner" href="https://github.com/kentonv/capnproto">View on GitHub</a>
    </div>

    

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">

      <section id="menu">
        <ul>
          <li><a href="/capnproto/index.html">Introduction</a></li>
          <li><a href="/capnproto/news/">News</a></li>
          <li><a href="/capnproto/install.html">Installation</a></li>
          <li><a href="/capnproto/language.html">Schema Language</a></li>
          <li><a href="/capnproto/encoding.html">Encoding</a></li>
          <li><a href="/capnproto/rpc.html">RPC Protocol</a></li>
          <li><a href="/capnproto/capnp-tool.html">The <code>capnp</code> Tool</a></li>
          <li><a href="/capnproto/cxx.html">C++ Serialization</a></li>
          <li><a href="/capnproto/cxxrpc.html">C++ RPC</a></li>
          <li><a href="/capnproto/otherlang.html">Other Languages</a></li>
          <li><a href="/capnproto/roadmap.html">Road Map</a></li>
          <li><a href="/capnproto/faq.html">FAQ</a></li>
        </ul>
      </section>
      <section id="main_content" class="inner">

<h1 id="other-languages">Other Languages</h1>

<p>Cap’n Proto’s reference implementation is in C++.  Implementations in other languages are
maintained by respective authors and have not been reviewed by me
(<a href="https://github.com/kentonv">@kentonv</a>). Below are the implementations I’m aware
of. Some of these projects are more “ready” than others; please consult each
project’s documentation for details.</p>

<h5 id="serialization--rpc">Serialization + RPC</h5>

<ul>
  <li><a href="cxx.html">C++</a> by <a href="https://github.com/kentonv">@kentonv</a></li>
  <li><a href="https://github.com/kentonv/node-capnp">Javascript (Node.js only)</a> by <a href="https://github.com/kentonv">@kentonv</a></li>
  <li><a href="http://jparyani.github.io/pycapnp/">Python</a> by
<a href="https://github.com/jparyani">@jparyani</a></li>
  <li><a href="https://github.com/dwrensha/capnproto-rust">Rust</a> by <a href="https://github.com/dwrensha">@dwrensha</a></li>
</ul>

<h5 id="serialization-only">Serialization only</h5>

<ul>
  <li><a href="https://github.com/jmckaskill/c-capnproto">C</a> by <a href="https://github.com/jmckaskill">@jmckaskill</a></li>
  <li><a href="http://ecapnp.astekk.se/">Erlang</a> by <a href="https://github.com/kaos">@kaos</a></li>
  <li><a href="https://github.com/glycerine/go-capnproto">Go</a> by <a href="https://github.com/glycerine">@glycerine</a> (originally by <a href="https://github.com/jmckaskill">@jmckaskill</a>)</li>
  <li><a href="https://github.com/dwrensha/capnproto-java/">Java</a> by <a href="https://github.com/dwrensha">@dwrensha</a></li>
  <li><a href="https://github.com/popham/capnp-js-base">Javascript</a> by <a href="https://github.com/popham">@popham</a></li>
  <li><a href="https://github.com/jscheid/capnproto-js">Javascript</a> (older, abandoned) by <a href="https://github.com/jscheid">@jscheid</a></li>
  <li><a href="https://github.com/cloudflare/lua-capnproto">Lua</a> by <a href="http://www.cloudflare.com/">CloudFlare</a> / <a href="https://github.com/calio">@calio</a></li>
  <li><a href="https://github.com/pelzlpj/capnp-ocaml">OCaml</a> by <a href="https://github.com/pelzlpj">@pelzlpj</a></li>
  <li><a href="https://github.com/cstrahan/capnp-ruby">Ruby</a> by <a href="https://github.com/cstrahan">@cstrahan</a></li>
</ul>

<h5 id="tools">Tools</h5>

<p>These are other misc projects related to Cap’n Proto that are not actually implementations in
new languages.</p>

<ul>
  <li><a href="https://github.com/kaos/capnp_test">Common Test Framework</a> by <a href="https://github.com/kaos">@kaos</a></li>
  <li><a href="https://github.com/cstrahan/vim-capnp">Vim Syntax Highlighting</a> by
<a href="https://github.com/cstrahan">@cstrahan</a></li>
  <li><a href="https://github.com/kaos/wireshark-plugins">Wireshark Dissector Plugin</a> by <a href="https://github.com/kaos">@kaos</a></li>
</ul>

<h2 id="contribute-your-own">Contribute Your Own!</h2>

<p>We’d like to support many more languages in the future!</p>

<p>If you’d like to own the implementation of Cap’n Proto in some particular language,
<a href="https://groups.google.com/group/capnproto">let us know</a>!</p>

<p><strong>You should e-mail the list <em>before</em> you start hacking.</strong>  We don’t bite, and we’ll probably have
useful tips that will save you time.  :)</p>

<p><strong>Do not implement your own schema parser.</strong>  The schema language is more complicated than it
looks, and the algorithm to determine offsets of fields is subtle.  If you reuse the official
parser, you won’t risk getting these wrong, and you won’t have to spend time keeping your parser
up-to-date.  In fact, you can still write your code generator in any language you want, using
compiler plugins!</p>

<h3 id="how-to-write-compiler-plugins">How to Write Compiler Plugins</h3>

<p>The Cap’n Proto tool, <code>capnp</code>, does not actually know how to generate code.  It only parses schemas,
then hands the parse tree off to another binary – known as a “plugin” – which generates the code.
Plugins are independent executables (written in any language) which read a description of the
schema from standard input and then generate the necessary code.  The description is itself a
Cap’n Proto message, defined by
<a href="https://github.com/kentonv/capnproto/blob/master/c%2B%2B/src/capnp/schema.capnp">schema.capnp</a>.
Specifically, the plugin receives a <code>CodeGeneratorRequest</code>, using
<a href="http://kentonv.github.io/capnproto/encoding.html#serialization_over_a_stream">standard serialization</a>
(not packed).  (Note that installing the C++ runtime causes schema.capnp to be placed in
<code>$PREFIX/include/capnp</code> – <code>/usr/local/include/capnp</code> by default).</p>

<p>Of course, because the input to a plugin is itself in Cap’n Proto format, if you write your
plugin directly in the language you wish to support, you may have a bootstrapping problem:  you
somehow need to generate code for <code>schema.capnp</code> before you write your code generator.  Luckily,
because of the simplicity of the Cap’n Proto format, it is generally not too hard to do this by
hand.  Remember that you can use <code>capnp compile -ocapnp schema.capnp</code> to get a dump of the sizes
and offsets of all structs and fields defined in the file.</p>

<p><code>capnp compile</code> normally looks for plugins in <code>$PATH</code> with the name <code>capnpc-[language]</code>, e.g.
<code>capnpc-c++</code> or <code>capnpc-capnp</code>.  However, if the language name given on the command line contains
a slash character, <code>capnp</code> assumes that it is an exact path to the plugin executable, and does not
search <code>$PATH</code>.  Examples:</p>

<pre><code># Searches $PATH for executable "capnpc-mylang".
capnp compile -o mylang addressbook.capnp

# Uses plugin executable "myplugin" from the current directory.
capnp compile -o ./myplugin addressbook.capnp
</code></pre>

<p>If the user specifies an output directory, the compiler will run the plugin with that directory
as the working directory, so you do not need to worry about this.</p>

<p>For examples of plugins, take a look at
<a href="https://github.com/kentonv/capnproto/blob/master/c%2B%2B/src/capnp/compiler/capnpc-capnp.c%2B%2B">capnpc-capnp</a>
or <a href="https://github.com/kentonv/capnproto/blob/master/c%2B%2B/src/capnp/compiler/capnpc-c%2B%2B.c%2B%2B">capnpc-c++</a>.</p>

<h3 id="supporting-dynamic-languages">Supporting Dynamic Languages</h3>

<p>Dynamic languages have no compile step.  This makes it difficult to work <code>capnp compile</code> into the
workflow for such languages.  Additionally, dynamic languages are often scripting languages that do
not support pointer arithmetic or any reasonably-performant alternative.</p>

<p>Fortunately, dynamic languages usually have facilities for calling native code.  The best way to
support Cap’n Proto in a dynamic language, then, is to wrap the C++ library, in particular the
<a href="cxx.html#dynamic_reflection">C++ dynamic API</a>.  This way you get reasonable performance while
still avoiding the need to generate any code specific to each schema.</p>

<p>To parse the schema files, use the <code>capnp::SchemaParser</code> class (defined in <code>capnp/schema-parser.h</code>).
This way, schemas are loaded at the same time as all the rest of the program’s code – at startup.
An advanced implementation might consider caching the compiled schemas in binary format, then
loading the cached version using <code>capnp::SchemaLoader</code>, similar to the way e.g. Python caches
compiled source files as <code>.pyc</code> bytecode, but that’s up to you.</p>

<h3 id="testing-your-implementation">Testing Your Implementation</h3>

<p>The easiest way to test that you’ve implemented the spec correctly is to use the <code>capnp</code> tool
to <a href="capnp-tool.html#encoding_messages">encode</a> test inputs and
<a href="capnp-tool.html#decoding_messages">decode</a> outputs.</p>

<script type="text/javascript">setupSidebar()</script>
        <div style="clear: both;"></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cap'n Proto maintained by <a href="https://github.com/kentonv">kentonv</a>
          <span class="gplus-followbutton"><span class="g-follow" data-annotation="bubble" data-height="15" data-href="//plus.google.com/118187272963262049674" data-rel="author"></span></span>
          <a href="https://www.gittip.com/kentonv/"><img class="gittip15" src="/capnproto/images/gittip15.png" alt="Gittip"></a></p>
        <p>Design by <a href="http://www.starfruit-cafe.net/blog">sailorhg</a> ∙ Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    <!-- Google+ follow button. -->
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>

    <!-- Google Analytics. -->
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-39711112-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>

