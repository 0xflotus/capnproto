<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=480">

    <link rel="stylesheet" type="text/css" media="screen" href="/capnproto/next/stylesheets/stylesheet.css">

    <title>Cap'n Proto: Installation</title>

    <script type="text/javascript" src="/capnproto/next/javascripts/main.js"></script>
  </head>

  <body class="desktop">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <header class="inner">
        <img src="/capnproto/next/images/logo.png">
        <div id="infinitely_faster">
          <img src="/capnproto/next/images/infinitely_faster.png">
        </div>
      </header>
      <a id="discuss_banner" href="https://groups.google.com/group/capnproto">Discuss on Groups</a>
      <a id="forkme_banner" href="https://github.com/kentonv/capnproto">View on GitHub</a>
    </div>

    
    <div id="next_banner">
      <h1>PREVIEW</h1>
      <p>You are looking at the site as it will appear after the next release.  This is a draft
         version that may be incomplete, buggy, or not yet applicable.  To look at the current
         site, <a href="../">click here</a>.
    </div>
    

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">

      <section id="menu">
        <ul>
          <li><a href="/capnproto/next/index.html">Introduction</a></li>
          <li><a href="/capnproto/next/news/">News</a></li>
          <li><a href="/capnproto/next/install.html">Installation</a></li>
          <li><a href="/capnproto/next/language.html">Schema Language</a></li>
          <li><a href="/capnproto/next/encoding.html">Encoding</a></li>
          <li><a href="/capnproto/next/rpc.html">RPC Protocol</a></li>
          <li><a href="/capnproto/next/capnp-tool.html">The <code>capnp</code> Tool</a></li>
          <li><a href="/capnproto/next/cxx.html">C++ Serialization</a></li>
          <li><a href="/capnproto/next/cxxrpc.html">C++ RPC</a></li>
          <li><a href="/capnproto/next/otherlang.html">Other Languages</a></li>
          <li><a href="/capnproto/next/roadmap.html">Road Map</a></li>
          <li><a href="/capnproto/next/faq.html">FAQ</a></li>
        </ul>
      </section>
      <section id="main_content" class="inner">

<h1 id="installation">Installation</h1>
<p style='font-size: 125%; font-weight: bold;'>Note: Cap'n Proto is in BETA</p><div style='float: right'><a class='groups_link' href='https://groups.google.com/group/capnproto-announce' style='color: #fff'>Sign Up for Updates</a></div>
<p>As of this writing, Cap’n Proto is in beta. The serialization layer is close to feature-complete and we don’t anticipate any further changes to the wire format. That said, if you want to use it, you should keep in mind some caveats:</p>

<ul>
<li><strong>Security:</strong> Cap’n Proto has not yet had a security review. Although Kenton has a background in security and is not aware of any vulnerabilities in the current code, it’s likely that there are a few. For now, do not accept Cap’n Proto messages from parties you do not trust.</li>

<li><strong>API Stability:</strong> The Cap’n Proto programming interface may still change in ways that break existing code. Such changes are likely to be minor and should not affect the wire format.</li>

<li><strong>Performance:</strong> While Cap’n Proto is inherently fast by design, the implementation has not yet undergone serious profiling and optimization. Currently it only beats Protobufs in realistic-ish end-to-end benchmarks by around 2x-5x. We can do better.</li>

<li><strong>RPC:</strong> The RPC implementation is very new (introduced in v0.4 / Dec 2013). It is missing many features that are essential in real-world use (like timeouts), the interface is still in flux, and it needs a lot of optimization work.</li>
</ul>

<p>If you’d like to hack on Cap’n Proto, you should join the <a href="https://groups.google.com/group/capnproto">discussion group</a>!</p>

<p>If you’d just like to receive updates as things progress, add yourself to the <a href="https://groups.google.com/group/capnproto-announce">announce list</a>.</p>

<h2 id="installing_the_capn_proto_tools_and_c_runtime">Installing the Cap’n Proto tools and C++ Runtime</h2>

<p>The Cap’n Proto tools, including the compiler which takes <code>.capnp</code> files and generates source code for them, are written in C++. Therefore, you must install the C++ package even if your actual development language is something else.</p>

<p>This package is licensed under the <a href="http://opensource.org/licenses/BSD-2-Clause">BSD 2-Clause License</a>.</p>

<h3 id="gcc_47_or_clang_32_needed">GCC 4.7 or Clang 3.2 Needed</h3>

<p>If you are using GCC, you MUST use at least version 4.7 as Cap’n Proto uses recently-implemented C++11 features. If GCC 4.7 is installed but your system’s default GCC is older, you will probably need to set the environment variable <code>CXX=g++-4.7</code> before following the instructions below.</p>

<p>If you are using Clang, you must use at least version 3.2. To use Clang, set the environment variable <code>CXX=clang++</code> before following any instructions below, otherwise <code>g++</code> is used by default.</p>

<p>This package is officially tested on Linux (GCC 4.7, GCC 4.8, Clang 3.2), Mac OSX (Xcode 5), and Cygwin (Windows; GCC 4.8), in 32-bit and 64-bit modes.</p>

<p>Mac/Xcode users: You must use at least Xcode 5, and you must download the Xcode command-line tools under Xcode menu &gt; Preferences &gt; Downloads. Alternatively, compiler builds from <a href="http://www.macports.org/">Macports</a>, <a href="http://www.finkproject.org/">Fink</a>, or <a href="http://brew.sh/">Homebrew</a> are reported to work.</p>

<h3 id="building_from_a_release_package">Building from a release package</h3>

<p>You may download and install the release version of Cap’n Proto like so:</p>
<pre><code>curl -O <a href='http://capnproto.org/capnproto-c++-0.0.0.tar.gz'>http://capnproto.org/capnproto-c++-0.0.0.tar.gz</a>
tar zxf capnproto-c++-0.0.0.tar.gz
cd capnproto-c++-0.0.0
./configure
make -j6 check
sudo make install</code></pre>
<p>This will install <code>capnp</code>, the Cap’n Proto command-line tool. It will also install <code>libcapnp</code>, <code>libcapnpc</code>, and <code>libkj</code> in <code>/usr/local/lib</code> and headers in <code>/usr/local/include/capnp</code> and <code>/usr/local/include/kj</code>.</p>

<h3 id="building_from_git_with_autotools">Building from Git with Autotools</h3>

<p>If you download directly from Git, and you don’t want to <a href="install.html#building_with_ekam">build with Ekam</a>, you will need to have the GNU autotools – <a href="http://www.gnu.org/software/autoconf/">autoconf</a>, <a href="http://www.gnu.org/software/automake/">automake</a>, and <a href="http://www.gnu.org/software/libtool/">libtool</a> – installed. You will also need Subversion installed (in addition to Git) in order to fetch the Google Test sources (done by <code>setup-autotools.sh</code>).</p>

<pre><code>git clone https://github.com/kentonv/capnproto.git
cd capnproto/c++
./setup-autotools.sh
autoreconf -i
./configure
make -j6 check
sudo make install</code></pre>

<h3 id="building_with_ekam">Building with Ekam</h3>

<p>Ekam is a build system I wrote a while back that automatically figures out how to build your C++ code without instructions. It also supports continuous builds, where it watches the filesystem for changes (via inotify) and immediately rebuilds as necessary. Instant feedback is key to productivity, so I really like using Ekam.</p>

<p>Unfortunately it’s very much unfinished. It works (for me), but it is quirky and rough around the edges. It only works on Linux, and is best used together with Eclipse. If you find it unacceptable, scroll up to the <a href="#building_from_git_with_autotools">Automake instructions</a>.</p>

<p>The Cap’n Proto repo includes a script which will attempt to set up Ekam for you.</p>

<pre><code>git clone https://github.com/kentonv/capnproto.git
cd capnproto/c++
./setup-ekam.sh</code></pre>

<p>If all goes well, this downloads the Ekam code into a directory called <code>.ekam</code> and adds some symlinks under src. It also imports the <a href="https://googletest.googlecode.com">Google Test</a> and <a href="http://protobuf.googlecode.com">Protobuf</a> source code, so you can compile tests and benchmarks.</p>

<p>Once Ekam is installed, you can do:</p>

<pre><code>make -f Makefile.ekam once</code></pre>

<p>This will build everything it can and run tests.</p>

<p>Note that Ekam will fail to build some things and output a bunch of error messages. You should be able to ignore any errors that originate outside of the <code>capnp</code> and <code>kj</code> directories – these are just parts of other packages like Google Test that Ekam doesn’t fully know how to build, but aren’t needed by Cap’n Proto anyway.</p>

<h4 id="running_the_benchmarks">Running the Benchmarks</h4>

<p>Before getting into benchmarks, let me be frank: performance varies wildly by use case, and no benchmark is going to properly reflect the big picture. If performance is critical to your use case, you should write a benchmark specific to your case, and test multiple serialization technologies. Don’t assume anything. If you find Cap’n Proto performs sub-optimally, though, <a href="https://groups.google.com/group/capnproto">tell us about it</a>.</p>

<p>That said, Cap’n Proto does have a small suite of silly benchmarks used to validate changes.</p>

<p>The Ekam build will put the benchmark binaries in <code>tmp/capnp/benchmark</code>.</p>

<pre><code>tmp/capnp/benchmark/runner</code></pre>

<p>This runs the default test case, CatRank. CatRank simulates a search engine scoring algorithm which promotes pages that discuss cats (and demotes ones discussing dogs). A list of up to 1000 random search results with URLs, scores, and snippets is sent to the server, which searches the snippets for instances of “cat” and “dog”, adjusts their scores accordingly, then returns the new result list sorted by score.</p>

<p>This test case is very string-heavy. Cap’n Proto performs well due to its zero-copy strings, but packing the message doesn’t help much.</p>

<pre><code>tmp/capnp/benchmark/runner eval</code></pre>

<p>In this test case, the client generates a random, deeply-nested arithmetic expression for the server to evaluate. This case is a pathologically bad case for Cap’n Proto as it involves lots of pointers with relatively little actual data. When packing is enabled it actually loses to Protobufs by a little bit on CPU time (as of this writing, at least; it’ll probably get better with optimization).</p>

<pre><code>tmp/capnp/benchmark/runner carsales</code></pre>

<p>This test case involves sending to the server a description of a bunch of cars, and asks the server to decide how much the lot is worth. This case is very number-heavy, and because of this Cap’n Proto’s “packed” mode really shines.</p>

<h4 id="developing_with_ekam">Developing with Ekam</h4>

<p>If you intend to do some development, you should build <code>continuous</code> or <code>continuous-opt</code> instead of <code>once</code>. These modes will build everything, then watch the source tree for changes and rebuild as necessary. <code>continuous</code> does a debug build while <code>continuous-opt</code> optimizes; the former is best while developing but don’t run the benchmarks in debug mode!</p>

<p>If you use Eclipse, you should use the Ekam Eclipse plugin to get build results fed back into your editor while building in continuous mode. Build the plugin like so:</p>

<ol>
<li>Open the <code>.ekam/eclipse</code> directory as an Eclipse project.</li>

<li>File -&gt; Export -&gt; Plug-in Development -&gt; Deployable Plug-ins and Fragments.</li>

<li>Choose the Ekam Dashboard project and export to your Eclipse directory, or export to another directory and copy the files into your Eclipse directory.</li>

<li>Restart Eclipse.</li>

<li>Make sure you have some sort of project in your work space containing your Ekam source tree. It should be rooted at the directory containing “src”, “tmp”, etc. The plugin will mark errors within this project.</li>

<li>Window -&gt; Show View -&gt; Other -&gt; Ekam -&gt; Ekam Dashboard</li>
</ol>

<p>The dashboard view lets you browse the whole tree of build actions and also populates your editor with error markers.</p>
<script type="text/javascript">setupSidebar()</script>
        <div style="clear: both;"></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cap'n Proto maintained by <a href="https://github.com/kentonv">kentonv</a>
          <span class="gplus-followbutton"><span class="g-follow" data-annotation="bubble" data-height="15" data-href="//plus.google.com/118187272963262049674" data-rel="author"></span></span>
          <a href="https://www.gittip.com/kentonv/"><img class="gittip15" src="/capnproto/next/images/gittip15.png" alt="Gittip"></a></p>
        <p>Design by <a href="http://www.starfruit-cafe.net/blog">sailorhg</a> ∙ Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    <!-- Google+ follow button. -->
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>

    <!-- Google Analytics. -->
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-39711112-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>

